<!DOCTYPE html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="description" content="Otevřené místo pro všechny PHP programátory">
<meta name="keywords" content="PHP, komunita, programování, srazy, školení, blog, články">
<meta name="author" content="https://pehapkari.cz">
<meta name="robots" content="index, follow">

<meta property="og:image" content="/assets/images/meetup.jpg">
<meta property="fb:pages" content="918297778220033" />

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="alternate" type="application/rss+xml" title="Péhápkaři.cz Blog RSS" href="/rss.xml">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap&subset=latin-ext" rel="stylesheet">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<link href="/favicon.ico" rel="shortcut icon">

<title>
     Domain-Driven Design, part 4 - Implementation | Děláš v PHP? Jsi jedním z nás
</title>

<link rel="stylesheet" href="/build/css/app.86e96c5c.css">

<link rel="stylesheet" href="/assets/prism/prism.css">
<link rel="stylesheet" href="/assets/prism/prism-custom.css">

<link rel="stylesheet" href="https://use.typekit.net/jmg2upk.css">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i|Ubuntu+Mono&amp;subset=latin-ext" rel="stylesheet">

        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    </head>

    <body id="">
        <nav id="ph-nav" class="navbar fixed-top navbar-expand navbar-light bg-light ph-nav border-bottom hidden-sm-down">
    <div class="container">
        <a class="ph-nav__logo" href="/">
            <img src="/assets/pehapkari_logo/logo.svg" alt="logo" title="">
            <br>
            <p>Péhápkaři</p>
        </a>

        <div id="top-menu-search" class="hidden-md-down">
            <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="pehapkari.cz" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Napiš co hledáš..." autocomplete="off"/>
</form>
        </div>

        <ul class="navbar-nav ml-auto hidden-sm-down" id="menu">
            <li>
                <a class="active" href="/blog">
                    Blog
                </a>
            </li>
            <li>
                <a class="" href="/prehaj-si-prednasku">
                    Videa
                </a>
            </li>
            <li class="pr-0">
                <a class="" href="/kontakt">
                    Kontakt
                </a>
            </li>
        </ul>
    </div>
</nav>

<div id="mobile-menu" class="row ml-0 mr-0 text-center hidden-md-up border-bottom">
    <a href="/" class="ph-nav__logo col-3 ">
        <img src="/assets/pehapkari_logo/logo.svg" alt="logo" title="">
    </a>

    <a href="/prehaj-si-prednasku" class="col-3 ">
        Videa
    </a>
    <a href="/blog" class="col-3 ">
        Blog
    </a>
</div>

                    <div id="main">
                

                    <div class="container" id="article">
        <h1>Domain-Driven Design, part 4 - Implementation</h1>

        <strong>Svaťa Šimara</strong>
        &nbsp;
        <time datetime="2018-02-Wed">
            21. 2. 2018
        </time>

        <br>

        <div class="card mt-4 mb-4">
            <div class="card-body text-bigger">
                <p>It is great to model something and now we have reached the point where we turn the model into the code.
We will implement the model, no persistence, no input, only the most important part - the domain model.
The implementation will be supported by tests and we will see how easy it is to test domain objects.
We will also discuss the connection to the ubiquitous language and model and practical aspect of object encapsulation.</p>
            </div>
        </div>

        <h2>Model</h2>
<p>It doesn't make sense to explain implementation on <em>Foo, Bar, etc...</em>, the Domain-driven design is about the domain.
Let's use the e-shop cart model from <a href="/blog/2017/12/16/domain-driven-design-model/">previous</a> <a href="/blog/2018/01/06/domain-driven-design-simplify-object-model/">articles</a>.</p>
<p><img src="/assets/images/posts/2018/ddd-implementation/cart_aggregate.png" alt="cart aggregate" /></p>
<h2>Implementing the Domain Model</h2>
<p>Now we have the domain model and all terms come from the ubiquitous language.
We have to use the ubiquitous language in the code too, so the whole project uses the same language.
When we find something we cannot name, we have to deepen the domain knowledge so the term comes from domain again.</p>
<p>During the implementation, we might think of generalizing or coding for the future.
We should resist these ideas, these thoughts, and implement only the model which we know.
Implementing only the known behavior also makes the development quicker and the testing easier.</p>
<p>We should implement the model as accurate as possible.
But sometimes we can find a problem which is difficult or impossible to implement in the programming language we use.
Then we have to do decisions that also changes the model and these decisions should be spread over the team so everyone understands the changed model.</p>
<h2>Read Information from Object</h2>
<p>A common requirement is to read an information from an object.
It doesn't have to be necessary reading the internal state, we just need to get some information.</p>
<p>We have two reading use cases in the cart story.
It is <em>showing the cart detail</em> and <em>calculating the cart total price</em>.
When we show the cart to the user, we also show the total price and when we show the total price, we usually show the detail or information extracted from the detail.
So we can join these two use cases into one - <em>calculate the cart detail</em>.
This decision may be changed in the future as we consider what is more practical.</p>
<h3>Getters Intermezzo</h3>
<p>I think that the object-oriented programming is about encapsulating objects by behavior.
I think this is the reason for the whole OOP.
Getters are not a behavior for me, getters just break encapsulation according to my opinion.
So I try to do my best to avoid getters.
But as we can see in the code, I'm still not able to avoid all ot them.</p>
<p>Instead of tones of getters, I try to use immutable structures to pass information through the system.
These structures are based on use cases needs.</p>
<h3>Data Transfer Object over Array</h3>
<p>Since we are programming in the PHP, arrays are the first choice how to pass multiple information.
But there are issues with arrays.
The structure cannot be thrust, we can read a certain key but it doesn't have to be there.
The data types are not thrust, is it an integer, a string or another array? IDE can not help us by suggesting keys and types.
Arrays are mutable so we don't know if the information wasn't unintentionally changed.</p>
<p>Data transfer objects avoid these problems.
It takes some time to write them but once we have them, it is comfortable to use them.
Data transfer objects are not classic objects, we do not expect behavior, they supplement immutable structures that are missing in the PHP.</p>
<h2>The Implementation</h2>
<p>The article would be enormous if it contained all the code and the code would be difficult to navigate through.
So please find the code on the GitHub:
<a href="https://github.com/pehapkari/pehapkari.cz/tree/master/src/Posts/Year2018/Cart/Domain">https://github.com/pehapkari/pehapkari.cz/tree/master/statie/tests/Posts/Year2018/Cart/Domain</a></p>
<p>But comment it here, the code is a part of this article.</p>
<h2>Testing</h2>
<p>Domain has nothing to do with an infrastructure like a database or a data source like a UI form or an API.
Domain objects are absolutely independent, so they are quite easy to test.
Tests should come from use cases and they should also test edge cases.</p>
<p>We should focus on testing aggregates.
Internal structure of aggregates may change, but their behavior is less likely to change.
We can consider aggregate tests as unit tests because an aggregate is definitely a unit.
But we can test whatever we want to, if there is an interesting internal class, it is a great idea to test it too.</p>
<p>Please find tests on the GitHub:
<a href="https://github.com/pehapkari/pehapkari.cz/tree/master/tests/Posts/Year2018/Cart/Domain">https://github.com/pehapkari/pehapkari.cz/tree/master/statie/tests/Posts/Year2018/Cart/Domain</a></p>
<h2>Test-Driven Development</h2>
<p>Test-driven development is popular and this approach is pretty fine.
But how can be development driven by two different paradigms? Test-driven development tells us to write tests first.
Domain-driven design tells us to focus on the domain.
How do these styles interfere with each other? Well, they actually don't.</p>
<p>Write tests first is great because we write tests by use cases so we know what do we expect.
It may happen that we don't know the answer to the test question.
This situation leads us to deepen the domain knowledge before writing a single line of code.</p>
<p>And by the way, DDD is about the design while TDD is about the development process.</p>
<p>The cart implementation was written using TDD.
Test first, then implementation and some refactoring:
<a href="https://github.com/simara-svatopluk/cart/commits/TDD">https://github.com/simara-svatopluk/cart/commits/TDD</a></p>
<h2>TL;DR</h2>
<p>Keep ubiquitous language terms in the code, avoid getters and use data transfer objects.
Testing pure domain object is easy, so test at least aggregates.</p>
<h2>Complete Code</h2>
<ul>
<li><a href="https://github.com/simara-svatopluk/cart/tree/domain-logic">https://github.com/simara-svatopluk/cart/tree/domain-logic</a> <strong>domain-logic</strong> tag only</li>
<li><a href="https://github.com/simara-svatopluk/cart/commits/TDD">https://github.com/simara-svatopluk/cart/commits/TDD</a></li>
</ul>
<h2>Contact</h2>
<p>Are you designing architecture and like DDD approach? Hire me, I can help you - <a href="http://svatasimara.cz/">svatasimara.cz</a></p>

        <br>

        <div class="container">
            <div id="disqus_thread"></div>

<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//pehapkari.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <br>
    </div>

            </div>
        
        <div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6 mt-3 mt-md-0">
                <p class="mb-2">Web Péhápkaři.cz pohání <a href="https://symfony.com/">Symfony</a> a najdeš ho na <a href="https://github.com/pehapkari/pehapkari.cz">Githubu</a>.</p>

                                            </div>

            <div class="col-12 col-md-6 mt-4 mt-md-0">
                <ul id="socials" class="pull-right">
                    <li>
                        <a href="https://facebook.com/pehapkari">
                            <em class="fab fa-2x fa-facebook"></em>
                        </a>
                    </li>

                    <li>
                        <a href="https://twitter.com/pehapkari">
                            <em class="fab fa-2x fa-twitter"></em>
                        </a>
                    </li>

                    <li>
                        <a href="https://meetup.com/friends-of-php-prague/">
                            <em class="fab fa-2x fa-meetup"></em>
                            <p>Praha</p>
                        </a>
                    </li>

                    <li>
                        <a href="https://meetup.com/Pehapkari-Brno/">
                            <em class="fab fa-2x fa-meetup"></em>
                            <p>Brno</p>
                        </a>
                    </li>

                    <li>
                        <a href="https://github.com/pehapkari">
                            <em class="fab fa-2x fa-github"></em>
                        </a>
                    </li>

                    <li>
                        <a href="https://join.slack.com/t/pehapkari/shared_invite/zt-b5kiu8w2-iqDCp8btryFmXeKiL21fXQ">
                            <em class="fab fa-2x fa-slack"></em>
                        </a>
                        <p>
                            <a href="https://join.slack.com/t/pehapkari/shared_invite/zt-b5kiu8w2-iqDCp8btryFmXeKiL21fXQ/">
                                <span class="hidden-sm-down">Pozvi se</span>
                                <span class="hidden-md-up">Pozvi</span>
                            </a>
                        </p>
                    </li>
                </ul>
            </div>
        </div>

        <div id="footer_body">
            <div class="row">
                <div class="col-6 col-md-4 mb-4 mb-md-0">
                    <h3>O nás</h3>

                    <ul class="bottom_menu">
                        <li>
                            <a href="/kontakt">Kontakt</a>
                        </li>

                        <li>
                            <a href="/for-speakers">Pro speakry</a>
                        </li>

                        <li>
                            <a href="https://github.com/pehapkari/pehapkari.cz/tree/master/public/assets/pehapkari_logo">Logo</a>
                        </li>

                        <li>
                            <a href="/rss.xml">RSS blogu</a>
                        </li>

                        <li>
                            <a href="http://bit.ly/pehapkari-newsletter">Sleduj Newsletter</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/build/js/app.78e31948.js"></script>

<script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
<script>
    $('document').ready(function() {
        var typed = new Typed('#typed',{
            stringsElement: '#typed-strings',
            typeSpeed: 50,
            backDelay: 1400,
        });
    });
</script>

<script src="/assets/prism/prism.js"></script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89860072-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-89860072-1');
</script>
    </body>
</html>
