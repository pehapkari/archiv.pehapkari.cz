<!DOCTYPE html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="description" content="Otevřené místo pro všechny PHP programátory">
<meta name="keywords" content="PHP, komunita, programování, srazy, školení, blog, články">
<meta name="author" content="https://pehapkari.cz">
<meta name="robots" content="index, follow">

<meta property="og:image" content="/assets/images/meetup.jpg">
<meta property="fb:pages" content="918297778220033" />

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="alternate" type="application/rss+xml" title="Péhápkaři.cz Blog RSS" href="/rss.xml">

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap&subset=latin-ext" rel="stylesheet">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<link href="/favicon.ico" rel="shortcut icon">

<title>
     Book Review: Refactoring | Děláš v PHP? Jsi jedním z nás
</title>

<link rel="stylesheet" href="/build/css/app.86e96c5c.css">

<link rel="stylesheet" href="/assets/prism/prism.css">
<link rel="stylesheet" href="/assets/prism/prism-custom.css">

<link rel="stylesheet" href="https://use.typekit.net/jmg2upk.css">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i|Ubuntu+Mono&amp;subset=latin-ext" rel="stylesheet">

        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    </head>

    <body id="">
        <nav id="ph-nav" class="navbar fixed-top navbar-expand navbar-light bg-light ph-nav border-bottom hidden-sm-down">
    <div class="container">
        <a class="ph-nav__logo" href="/">
            <img src="/assets/pehapkari_logo/logo.svg" alt="logo" title="">
            <br>
            <p>Péhápkaři</p>
        </a>

        <div id="top-menu-search" class="hidden-md-down">
            <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction">
    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
    <input name="sitesearch" value="pehapkari.cz" type="hidden"/>
    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required" name="q" placeholder="Napiš co hledáš..." autocomplete="off"/>
</form>
        </div>

        <ul class="navbar-nav ml-auto hidden-sm-down" id="menu">
            <li>
                <a class="active" href="/blog">
                    Blog
                </a>
            </li>
            <li>
                <a class="" href="/prehaj-si-prednasku">
                    Videa
                </a>
            </li>
            <li class="pr-0">
                <a class="" href="/kontakt">
                    Kontakt
                </a>
            </li>
        </ul>
    </div>
</nav>

<div id="mobile-menu" class="row ml-0 mr-0 text-center hidden-md-up border-bottom">
    <a href="/" class="ph-nav__logo col-3 ">
        <img src="/assets/pehapkari_logo/logo.svg" alt="logo" title="">
    </a>

    <a href="/prehaj-si-prednasku" class="col-3 ">
        Videa
    </a>
    <a href="/blog" class="col-3 ">
        Blog
    </a>
</div>

                    <div id="main">
                

                    <div class="container" id="article">
        <h1>Book Review: Refactoring</h1>

        <strong>Svaťa Šimara</strong>
        &nbsp;
        <time datetime="2019-05-Tue">
            21. 5. 2019
        </time>

        <br>

        <div class="card mt-4 mb-4">
            <div class="card-body text-bigger">
                <p>Review of the Refactoring: Improving the Design of Existing Code by <a href="https://martinfowler.com/">Martin Fowler</a>, 2nd edition (2018).</p>
            </div>
        </div>

        <p><img src="https://martinfowler.com/books/refact2.jpg" alt="Refactoring book" /></p>
<p>The book starts right away with an example of low-quality code and our goal is to add a feature.
Fowler attracts our attention as we immediately realize the need for refactoring.
Then we apply one refactoring after another, improve the code structure and after a couple of pages, we are able to add the feature without any additional effort.
The code is simply prepared for the feature to be added.</p>
<p>The author explains the importance of refactoring in a natural way - we realize we need to refactor, there is no other option.
Also often emphasizes the importance of automated tests because we cannot refactor without a proper test suite.
The first step of refactoring is to create tests and the book explains how to start with tests (but there are better sources for starting with tests like <a href="https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530?tag=uuid10-20">TDD by Kent Beck</a>).</p>
<p>Honestly, the important part of the book is the first 100 pages (of 400) and I recommend for every developer to read the first part of the book, the remaining part of the book is optional.</p>
<h2>Catalogue of Refactorings</h2>
<p>The remaining 300 pages is a catalog of refactoring and you can find it <a href="https://refactoring.com/catalog/">online</a>.
Each refactoring includes motivation - when, mechanics - how - in step-by-step form, and examples.
I like the step-by-step instructions when tests pass after each instruction.
It is awkward to apply these steps for simple refactorings, and powerful to apply for complicated refactorings or refactorings that involves a lot of occurrences.</p>
<p>All refactorings are explained really simply, even the difficult parts.
That's not because oversimplification, but it's because the author is a professional teacher, the explanation is just great.
Most of the refactorings are simple (sometimes too much like <a href="https://refactoring.com/catalog/removeDeadCode.html">Remove Dead Code</a>) but still practical.</p>
<h2>Personal Impression</h2>
<p>Almost all refactorings include inverse refactoring.
When there is <a href="https://refactoring.com/catalog/extractVariable.html">Extract Variable</a>, you can find also <a href="https://refactoring.com/catalog/inlineVariable.html">Inline Variable</a>.
That was a surprise for me as I thought the first option is always better (and I learned that's not true).</p>
<p>Extracting variable gives a name to the statement</p>
<pre><code class="language-php">return preg_replace('/(?:[,.]0+|([,.]\d*?)0+)$/', '$1', $value);

// refactored to
$croppingZerosPattern = '/(?:[,.]0+|([,.]\d*?)0+)$/';
return preg_replace($croppingZerosPattern, '$1', $value);</code></pre>
<p>On the other hand when the statement is self-explanatory, we can inline the variable</p>
<pre><code class="language-php">$itemsPrice = $this-&gt;getItemsPrice();
if ($itemsPrice &gt; $this-&gt;discountTreshold) {

// refactored to
if ($this-&gt;getItemsPrice() &gt; $this-&gt;discountTreshold) {</code></pre>
<p>I want to point out <a href="https://refactoring.com/catalog/replaceTypeCodeWithSubclasses.html">Replace Type Code with Subclasses</a> and <a href="https://refactoring.com/catalog/introduceSpecialCase.html">Introduce Special Case</a>.
Both introduce reasonable inheritance.
Reasonable inheritance is the most difficult part of OOP for me and these refactorings taught me something new.</p>
<p>Calculating coupon discount refactored from anemic model to objects using inheritance</p>
<pre><code class="language-php">if ($coupon-&gt;getType() === Coupon::PERCENTAGE) {
    $cart = $coupon-&gt;applyPercentaceDiscount($cart);
} elseif ($coupon-&gt;getType() === Coupon::ABSOLUTE) {
    $cart = $coupon-&gt;applyAbsoluteDiscount($cart);
}

// refactored to
abstract class Coupon {
    abstract public function applyDiscount(Cart $cart): Cart;
}
final class PercentageCoupon extends Coupon {
    public function applyDiscount(Cart $cart): Cart {
        // logic formerly in applyPercentaceDiscount
    }
}
final class AbsoluteCoupon extends Coupon {
    public function applyDiscount(Cart $cart): Cart {
        // logic formerly in applyAbsoluteDiscount
    }
}

$cart = $coupon-&gt;applyDiscount($cart);</code></pre>
<p>When there is no coupon filled, the special case handles it elegantly</p>
<pre><code class="language-php">if ($coupon !== null) {
    $cart = $cart-&gt;applyDiscount($cart);
}

// refactored to
class NoCoupon extends Coupon {
    public function applyDiscount(Cart $cart): Cart {
        return $cart;
    }
}

$cart = $cart-&gt;applyDiscount($cart);</code></pre>
<p>On the other hand, most of the refactorings were pretty simple or already known to me and I'd like to see more advanced refactorings, that's what I'm missing in the book.</p>
<h2>Language &amp; Code</h2>
<p>The book is easy to read, the author is using easy English and anyone who can read this review can read the book.</p>
<p>Code snippets are written in JavaScript, are simple and usually pretty short.
I saw a couple of pages of the 1st edition of the book and I can only congratulate Fowler for choosing the JavaScript because original Java code is really verbose.
Just compare</p>
<h4>2nd edition in JavaScript</h4>
<pre><code class="language-js">movie = {'name': "Pulp fiction"};</code></pre>
<h4>1st edition in Java</h4>
<pre><code class="language-java">class Movie {
    private String name;
    public Movie(String name) {
        this.name = name;
    }
    public String getName() {
        return name;
    }
}

Movie movie = new Movie("Pulp Fiction");</code></pre>
<p>this is not a Java criticism, JavaScript is just better for educative purposes in this case.</p>
<h2>Contact</h2>
<p>Do you need help with refactoring your legacy code? Hire me, I can help you - <a href="http://svatasimara.cz/">svatasimara.cz</a></p>

        <br>

        <div class="container">
            <div id="disqus_thread"></div>

<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//pehapkari.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <br>
    </div>

            </div>
        
        <div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6 mt-3 mt-md-0">
                <p class="mb-2">Web Péhápkaři.cz pohání <a href="https://symfony.com/">Symfony</a> a najdeš ho na <a href="https://github.com/pehapkari/pehapkari.cz">Githubu</a>.</p>

                                            </div>

            <div class="col-12 col-md-6 mt-4 mt-md-0">
                <ul id="socials" class="pull-right">
                    <li>
                        <a href="https://facebook.com/pehapkari">
                            <em class="fab fa-2x fa-facebook"></em>
                        </a>
                    </li>

                    <li>
                        <a href="https://twitter.com/pehapkari">
                            <em class="fab fa-2x fa-twitter"></em>
                        </a>
                    </li>

                    <li>
                        <a href="https://meetup.com/friends-of-php-prague/">
                            <em class="fab fa-2x fa-meetup"></em>
                            <p>Praha</p>
                        </a>
                    </li>

                    <li>
                        <a href="https://meetup.com/Pehapkari-Brno/">
                            <em class="fab fa-2x fa-meetup"></em>
                            <p>Brno</p>
                        </a>
                    </li>

                    <li>
                        <a href="https://github.com/pehapkari">
                            <em class="fab fa-2x fa-github"></em>
                        </a>
                    </li>

                    <li>
                        <a href="https://join.slack.com/t/pehapkari/shared_invite/zt-b5kiu8w2-iqDCp8btryFmXeKiL21fXQ">
                            <em class="fab fa-2x fa-slack"></em>
                        </a>
                        <p>
                            <a href="https://join.slack.com/t/pehapkari/shared_invite/zt-b5kiu8w2-iqDCp8btryFmXeKiL21fXQ/">
                                <span class="hidden-sm-down">Pozvi se</span>
                                <span class="hidden-md-up">Pozvi</span>
                            </a>
                        </p>
                    </li>
                </ul>
            </div>
        </div>

        <div id="footer_body">
            <div class="row">
                <div class="col-6 col-md-4 mb-4 mb-md-0">
                    <h3>O nás</h3>

                    <ul class="bottom_menu">
                        <li>
                            <a href="/kontakt">Kontakt</a>
                        </li>

                        <li>
                            <a href="/for-speakers">Pro speakry</a>
                        </li>

                        <li>
                            <a href="https://github.com/pehapkari/pehapkari.cz/tree/master/public/assets/pehapkari_logo">Logo</a>
                        </li>

                        <li>
                            <a href="/rss.xml">RSS blogu</a>
                        </li>

                        <li>
                            <a href="http://bit.ly/pehapkari-newsletter">Sleduj Newsletter</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/build/js/app.78e31948.js"></script>

<script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
<script>
    $('document').ready(function() {
        var typed = new Typed('#typed',{
            stringsElement: '#typed-strings',
            typeSpeed: 50,
            backDelay: 1400,
        });
    });
</script>

<script src="/assets/prism/prism.js"></script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89860072-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-89860072-1');
</script>
    </body>
</html>
